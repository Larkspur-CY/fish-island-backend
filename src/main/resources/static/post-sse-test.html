<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>POST + SSE æµå¼æµ‹è¯•ï¼ˆç°ä»£AIæ ‡å‡†ï¼‰</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f0f2f5; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        .methods { 
            display: flex; 
            gap: 20px; 
            margin-top: 20px; 
        }
        .method-section { 
            flex: 1; 
            border: 2px solid #e1e8ed; 
            padding: 20px; 
            border-radius: 10px; 
            background: #fafbfc;
        }
        .get-method { border-left: 4px solid #1da1f2; }
        .post-method { border-left: 4px solid #e1306c; }
        
        h3 {
            margin-top: 0;
            color: #14171a;
        }
        .get-method h3::before { content: "ğŸ”¹ "; color: #1da1f2; }
        .post-method h3::before { content: "ğŸ”¸ "; color: #e1306c; }
        
        button { 
            padding: 12px 24px; 
            margin: 5px; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .get-method button { 
            background: linear-gradient(135deg, #1da1f2, #0d8bd9); 
        }
        .post-method button { 
            background: linear-gradient(135deg, #e1306c, #c13584); 
        }
        button:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        button:disabled { 
            background: #aab8c2; 
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        
        .input-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #14171a;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #e1e8ed;
            border-radius: 6px;
            font-size: 14px;
        }
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .result { 
            border: 1px solid #e1e8ed; 
            padding: 15px; 
            margin: 15px 0; 
            min-height: 120px; 
            background: white;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
        }
        .debug { 
            background: #f7f9fa; 
            padding: 15px; 
            margin: 15px 0; 
            font-family: 'Courier New', monospace; 
            max-height: 250px; 
            overflow-y: auto;
            border-radius: 6px;
            border: 1px solid #e1e8ed;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .status {
            padding: 6px 12px;
            border-radius: 20px;
            display: inline-block;
            margin: 8px 0;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .status.connecting { background: #fff3cd; color: #856404; }
        .status.connected { background: #d4edda; color: #155724; }
        .status.completed { background: #d1ecf1; color: #0c5460; }
        .status.error { background: #f8d7da; color: #721c24; }
        
        .comparison-info {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }
        .comparison-info h4 {
            margin-top: 0;
        }
        .comparison-info ul {
            margin: 0;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ POST + SSE æµå¼æµ‹è¯•ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰</h1>
            <p>æµ‹è¯•ç°ä»£ AI æœåŠ¡æ ‡å‡†ï¼šPOST è¯·æ±‚ + Server-Sent Events å“åº”ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰</p>
        </div>
        
        <div class="methods">
            <!-- GET æ–¹å¼æµ‹è¯• -->
            <div class="method-section get-method">
                <h3>GET è¯·æ±‚æ–¹å¼ï¼ˆä¼ ç»Ÿï¼‰</h3>
                <div class="status" id="getStatus">å¾…æµ‹è¯•</div>
                
                <div class="input-group">
                    <label>æµ‹è¯•æ¶ˆæ¯ï¼š</label>
                    <input type="text" id="getMessage" value="GETæ–¹å¼æµ‹è¯•æ¶ˆæ¯" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯">
                </div>
                
                <button onclick="testGetMethod()">å¼€å§‹ GET æµ‹è¯•</button>
                <button onclick="stopGet()">åœæ­¢</button>
                
                <div><strong>å®æ—¶ç»“æœï¼š</strong></div>
                <div id="getResult" class="result">ç­‰å¾…æµ‹è¯•...</div>
                
                <div><strong>è°ƒè¯•æ—¥å¿—ï¼š</strong></div>
                <div id="getDebug" class="debug"></div>
            </div>
            
            <!-- POST æ–¹å¼æµ‹è¯• -->
            <div class="method-section post-method">
                <h3>POST è¯·æ±‚æ–¹å¼ï¼ˆç°ä»£AIæ ‡å‡†ï¼‰</h3>
                <div class="status" id="postStatus">å¾…æµ‹è¯•</div>
                
                <div class="input-group">
                    <label>è¯·æ±‚æ¶ˆæ¯ï¼š</label>
                    <textarea id="postMessage" placeholder="è¾“å…¥å¤æ‚çš„èŠå¤©æ¶ˆæ¯æˆ–JSONæ•°æ®">POSTæ–¹å¼å¯ä»¥å‘é€å¤æ‚çš„å¯¹è¯å†å²ã€é…ç½®å‚æ•°ç­‰ï¼ˆæ¨¡æ‹Ÿæ•°æ®æµ‹è¯•ï¼‰</textarea>
                </div>
                
                <button onclick="testPostMethod()">å¼€å§‹ POST æµ‹è¯•</button>
                <button onclick="testPostTyping()">æ‰“å­—æ•ˆæœæµ‹è¯•</button>
                <button onclick="stopPost()">åœæ­¢</button>
                
                <div><strong>å®æ—¶ç»“æœï¼š</strong></div>
                <div id="postResult" class="result">ç­‰å¾…æµ‹è¯•...</div>
                
                <div><strong>è°ƒè¯•æ—¥å¿—ï¼š</strong></div>
                <div id="postDebug" class="debug"></div>
            </div>
        </div>
        
        <div class="comparison-info">
            <h4>ğŸ“‹ GET vs POST + SSE å¯¹æ¯”</h4>
            <div style="display: flex; gap: 30px;">
                <div style="flex: 1;">
                    <strong>GET + SSEï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰ï¼š</strong>
                    <ul>
                        <li>å‚æ•°é€šè¿‡ URL ä¼ é€’</li>
                        <li>æœ‰é•¿åº¦é™åˆ¶ï¼ˆçº¦2KBï¼‰</li>
                        <li>ä¸é€‚åˆå¤æ‚å¯¹è¯</li>
                        <li>ç¼“å­˜å‹å¥½ä½†ä¸é€‚åˆæµå¼</li>
                    </ul>
                </div>
                <div style="flex: 1;">
                    <strong>POST + SSEï¼ˆç°ä»£æ ‡å‡†ï¼‰ï¼š</strong>
                    <ul>
                        <li>å¤æ‚æ•°æ®é€šè¿‡è¯·æ±‚ä½“å‘é€</li>
                        <li>æ— é•¿åº¦é™åˆ¶</li>
                        <li>æ”¯æŒèŠå¤©å†å²ã€é…ç½®ç­‰</li>
                        <li>Kimiã€DeepSeekã€OpenAI æ ‡å‡†</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let getEventSource = null;
        let postAbortController = null;  // æ”¹ä¸º AbortController æ§åˆ¶ POST è¯·æ±‚
        let getCompleted = false;
        let postCompleted = false;
        
        function updateStatus(type, status, text) {
            const statusDiv = document.getElementById(type + 'Status');
            statusDiv.className = 'status ' + status;
            statusDiv.textContent = text;
        }
        
        function addDebug(type, message) {
            const debugDiv = document.getElementById(type + 'Debug');
            const time = new Date().toLocaleTimeString();
            debugDiv.innerHTML += `<div style="margin: 2px 0;">[${time}] ${message}</div>`;
            debugDiv.scrollTop = debugDiv.scrollHeight;
        }
        
        function updateResult(type, content) {
            document.getElementById(type + 'Result').innerHTML = content;
        }
        
        // GET æ–¹å¼æµ‹è¯•ï¼ˆä¼ ç»ŸSSEï¼‰
        function testGetMethod() {
            if (getEventSource) {
                getEventSource.close();
            }
            
            getCompleted = false;
            const message = document.getElementById('getMessage').value;
            const url = `/api/chat/stream/mock?message=${encodeURIComponent(message)}`;
            
            startSSEConnection(url, 'get', 'getEventSource');
        }
        
        // POST æ–¹å¼æµ‹è¯•ï¼ˆçœŸæ­£çš„POST + SSEï¼‰
        async function testPostMethod() {
            if (postAbortController) {
                postAbortController.abort();
            }
            
            postAbortController = new AbortController();
            postCompleted = false;
            const message = document.getElementById('postMessage').value;
            
            let accumulatedText = '';
            let dataCount = 0;
            let startTime = Date.now();
            let buffer = ''; // ç¼“å†²åŒºå¤„ç†ä¸å®Œæ•´çš„æ•°æ®
            
            // æ›´æ–°çŠ¶æ€å’Œæ¸…ç©ºæ˜¾ç¤º
            updateStatus('post', 'connecting', 'è¿æ¥ä¸­...');
            updateResult('post', 'ğŸ”„ æ­£åœ¨å‘é€POSTè¯·æ±‚...');
            document.getElementById('post' + 'Debug').innerHTML = '';
            addDebug('post', 'ğŸš€ å‘é€POSTè¯·æ±‚åˆ°: /api/chat/stream/mock-post');
            addDebug('post', 'ğŸ“¤ POSTæ•°æ®: ' + JSON.stringify({message: message}));
            
            try {
                // ğŸ”¥ çœŸæ­£çš„ POST + SSE å®ç°ï¼ˆè°ƒç”¨æ¨¡æ‹Ÿæ•°æ®æ¥å£ï¼‰
                const response = await fetch('/api/chat/stream/mock-post', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'text/event-stream',
                        'Cache-Control': 'no-cache'
                    },
                    body: JSON.stringify({
                        message: message
                    }),
                    signal: postAbortController.signal  // æ”¯æŒå–æ¶ˆè¯·æ±‚
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                updateStatus('post', 'connected', 'å·²è¿æ¥');
                addDebug('post', 'âœ… POSTè¯·æ±‚æˆåŠŸï¼Œå¼€å§‹æ¥æ”¶æµå¼æ•°æ®...');
                
                // å¤„ç†æµå¼å“åº”
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                while (true) {
                    const { done, value } = await reader.read();
                    
                    if (done) {
                        addDebug('post', 'ğŸ æµå¼æ•°æ®æ¥æ”¶å®Œæˆï¼');
                        updateStatus('post', 'completed', 'ä¼ è¾“å®Œæˆ');
                        postCompleted = true;
                        break;
                    }
                    
                    // è§£ç å¹¶ç´¯ç§¯åˆ°ç¼“å†²åŒº
                    const chunk = decoder.decode(value, { stream: true });
                    buffer += chunk;
                    
                    // å¤„ç†ç¼“å†²åŒºä¸­çš„å®Œæ•´è¡Œ
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || ''; // ä¿ç•™æœ€åä¸€è¡Œï¼ˆå¯èƒ½ä¸å®Œæ•´ï¼‰
                    
                    for (const line of lines) {
                        if (line.startsWith('data:')) {
                            dataCount++;
                            const elapsed = Date.now() - startTime;
                            const data = line.slice(5); // å»æ‰ "data:" å‰ç¼€
                            
                            addDebug('post', `ğŸ“¨ ç¬¬${dataCount}æ¬¡æ¥æ”¶ (${elapsed}ms): "${data}"`);
                            
                            if (data === '[DONE]') {
                                postCompleted = true;
                                updateStatus('post', 'completed', 'ä¼ è¾“å®Œæˆ');
                                addDebug('post', `ğŸ æ•°æ®æ¥æ”¶å®Œæˆï¼æ€»è®¡ ${dataCount} æ¬¡ï¼Œè€—æ—¶ ${elapsed}ms`);
                                updateResult('post', '<div style="color: #28a745; font-weight: bold;">âœ… æœ€ç»ˆç»“æœï¼š</div><div style="background: #f8fff9; padding: 10px; border-radius: 4px; margin-top: 8px;">' + accumulatedText + '</div>');
                                return;
                            }
                            
                            // ğŸ”¥ å…³é”®æ‹¼æ¥é€»è¾‘ - å‚è€ƒGETè¯·æ±‚çš„ç®€å•æ‹¼æ¥
                            const oldText = accumulatedText;
                            accumulatedText += data; // ç›´æ¥æ‹¼æ¥ï¼Œä¸GETè¯·æ±‚ä¸€è‡´
                            
                            addDebug('post', `ğŸ”— æ•°æ®æ‹¼æ¥: "${oldText}" + "${data}"`);
                            
                            // å®æ—¶æ›´æ–°æ˜¾ç¤º
                            updateResult('post', '<div style="color: #495057; font-weight: bold;">ğŸ“ å®æ—¶æ‹¼æ¥å†…å®¹ï¼š</div><div style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin-top: 8px;">' + accumulatedText + '</div>');
                        }
                    }
                }
                
            } catch (error) {
                if (error.name === 'AbortError') {
                    addDebug('post', 'ğŸ›‘ è¯·æ±‚å·²è¢«å–æ¶ˆ');
                    updateStatus('post', 'error', 'æ‰‹åŠ¨åœæ­¢');
                } else {
                    updateStatus('post', 'error', 'è¯·æ±‚å¤±è´¥');
                    addDebug('post', 'âŒ POSTè¯·æ±‚å¤±è´¥: ' + error.message);
                    updateResult('post', '<div style="color: #dc3545; font-weight: bold;">âŒ è¯·æ±‚å¤±è´¥: ' + error.message + '</div>');
                }
            }
        }
        
        function startSSEConnection(url, type, eventSourceVar) {
            let accumulatedText = '';
            let dataCount = 0;
            let startTime = Date.now();
            
            // é‡ç½®å®ŒæˆçŠ¶æ€
            if (type === 'get') {
                getCompleted = false;
            } else if (type === 'post') {
                postCompleted = false;
            }
            
            // æ›´æ–°çŠ¶æ€å’Œæ¸…ç©ºæ˜¾ç¤º
            updateStatus(type, 'connecting', 'è¿æ¥ä¸­...');
            updateResult(type, 'ğŸ”„ æ­£åœ¨å»ºç«‹SSEè¿æ¥...');
            document.getElementById(type + 'Debug').innerHTML = '';
            addDebug(type, 'ğŸš€ å¼€å§‹è¿æ¥: ' + url);
            
            window[eventSourceVar] = new EventSource(url);
            
            window[eventSourceVar].onopen = function() {
                updateStatus(type, 'connected', 'å·²è¿æ¥');
                addDebug(type, 'âœ… SSEè¿æ¥æˆåŠŸï¼Œå¼€å§‹æ¥æ”¶æµå¼æ•°æ®...');
            };
            
            window[eventSourceVar].onmessage = function(event) {
                dataCount++;
                const elapsed = Date.now() - startTime;
                addDebug(type, `ğŸ“¨ ç¬¬${dataCount}æ¬¡æ¥æ”¶ (${elapsed}ms): "${event.data}"`);
                
                if (event.data === '[DONE]') {
                    // æ ‡è®°ä¸ºå®ŒæˆçŠ¶æ€
                    if (type === 'get') {
                        getCompleted = true;
                    } else if (type === 'post') {
                        postCompleted = true;
                    }
                    
                    updateStatus(type, 'completed', 'ä¼ è¾“å®Œæˆ');
                    addDebug(type, `ğŸ æµå¼æ•°æ®æ¥æ”¶å®Œæˆï¼æ€»è®¡ ${dataCount} æ¬¡ï¼Œè€—æ—¶ ${elapsed}ms`);
                    window[eventSourceVar].close();
                    updateResult(type, '<div style="color: #28a745; font-weight: bold;">âœ… æœ€ç»ˆç»“æœï¼š</div><div style="background: #f8fff9; padding: 10px; border-radius: 4px; margin-top: 8px;">' + accumulatedText + '</div>');
                    return;
                }
                
                // ğŸ”¥ å…³é”®æ‹¼æ¥é€»è¾‘
                const oldText = accumulatedText;
                accumulatedText += event.data;
                
                addDebug(type, `ğŸ”— æ•°æ®æ‹¼æ¥: "${oldText}" + "${event.data}"`);
                
                // å®æ—¶æ›´æ–°æ˜¾ç¤º
                updateResult(type, '<div style="color: #495057; font-weight: bold;">ğŸ“ å®æ—¶æ‹¼æ¥å†…å®¹ï¼š</div><div style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin-top: 8px;">' + accumulatedText + '</div>');
            };
            
            window[eventSourceVar].onerror = function(error) {
                // æ£€æŸ¥è¿æ¥æ˜¯å¦å·²ç»å®Œæˆï¼Œé¿å…è¯¯æŠ¥é”™è¯¯
                const isCompleted = (type === 'get' && getCompleted) || 
                                   (type === 'post' && postCompleted);
                                   
                if (isCompleted || window[eventSourceVar].readyState === EventSource.CLOSED) {
                    addDebug(type, 'âœ… è¿æ¥æ­£å¸¸å…³é—­');
                    return;
                }
                
                updateStatus(type, 'error', 'è¿æ¥é”™è¯¯');
                addDebug(type, 'âŒ SSEè¿æ¥é”™è¯¯: ' + JSON.stringify(error));
                updateResult(type, '<div style="color: #dc3545; font-weight: bold;">âŒ è¿æ¥é”™è¯¯</div>');
            };
        }
        
        function stopGet() {
            if (getEventSource && getEventSource.readyState !== EventSource.CLOSED) {
                getEventSource.close();
                updateStatus('get', 'error', 'æ‰‹åŠ¨åœæ­¢');
                addDebug('get', 'ğŸ›‘ æ‰‹åŠ¨åœæ­¢GETè¿æ¥');
            }
        }
        
        // POST æ‰“å­—æ•ˆæœæµ‹è¯•
        async function testPostTyping() {
            if (postAbortController) {
                postAbortController.abort();
            }
            
            postAbortController = new AbortController();
            postCompleted = false;
            const message = document.getElementById('postMessage').value;
            
            let accumulatedText = '';
            let dataCount = 0;
            let startTime = Date.now();
            let buffer = ''; // ç¼“å†²åŒºå¤„ç†ä¸å®Œæ•´çš„æ•°æ®
            
            // æ›´æ–°çŠ¶æ€å’Œæ¸…ç©ºæ˜¾ç¤º
            updateStatus('post', 'connecting', 'è¿æ¥ä¸­...');
            updateResult('post', 'ğŸ”„ æ­£åœ¨å‘é€POSTæ‰“å­—æ•ˆæœè¯·æ±‚...');
            document.getElementById('post' + 'Debug').innerHTML = '';
            addDebug('post', 'ğŸš€ å‘é€POSTæ‰“å­—æ•ˆæœè¯·æ±‚åˆ°: /api/chat/stream/typing-post');
            addDebug('post', 'ğŸ“¤ POSTæ•°æ®: ' + JSON.stringify({text: message}));
            
            try {
                // ğŸ”¥ çœŸæ­£çš„ POST + SSE æ‰“å­—æ•ˆæœå®ç°ï¼ˆè°ƒç”¨æ¨¡æ‹Ÿæ•°æ®æ¥å£ï¼‰
                const response = await fetch('/api/chat/stream/typing-post', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'text/event-stream',
                        'Cache-Control': 'no-cache'
                    },
                    body: JSON.stringify({
                        text: message
                    }),
                    signal: postAbortController.signal  // æ”¯æŒå–æ¶ˆè¯·æ±‚
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                updateStatus('post', 'connected', 'å·²è¿æ¥');
                addDebug('post', 'âœ… POSTæ‰“å­—æ•ˆæœè¯·æ±‚æˆåŠŸï¼Œå¼€å§‹æ¥æ”¶æµå¼æ•°æ®...');
                
                // å¤„ç†æµå¼å“åº”
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                while (true) {
                    const { done, value } = await reader.read();
                    
                    if (done) {
                        addDebug('post', 'ğŸ æ‰“å­—æ•ˆæœæµå¼æ•°æ®æ¥æ”¶å®Œæˆï¼');
                        updateStatus('post', 'completed', 'ä¼ è¾“å®Œæˆ');
                        postCompleted = true;
                        break;
                    }
                    
                    // è§£ç å¹¶ç´¯ç§¯åˆ°ç¼“å†²åŒº
                    const chunk = decoder.decode(value, { stream: true });
                    buffer += chunk;
                    
                    // å¤„ç†ç¼“å†²åŒºä¸­çš„å®Œæ•´è¡Œ
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || ''; // ä¿ç•™æœ€åä¸€è¡Œï¼ˆå¯èƒ½ä¸å®Œæ•´ï¼‰
                    
                    for (const line of lines) {
                        if (line.startsWith('data:')) {
                            dataCount++;
                            const elapsed = Date.now() - startTime;
                            const data = line.slice(5); // å»æ‰ "data:" å‰ç¼€
                            
                            addDebug('post', `ğŸ“¨ ç¬¬${dataCount}æ¬¡æ¥æ”¶ (${elapsed}ms): "${data}"`);
                            
                            if (data === '[DONE]') {
                                postCompleted = true;
                                updateStatus('post', 'completed', 'ä¼ è¾“å®Œæˆ');
                                addDebug('post', `ğŸ æ‰“å­—æ•ˆæœæ•°æ®æ¥æ”¶å®Œæˆï¼æ€»è®¡ ${dataCount} æ¬¡ï¼Œè€—æ—¶ ${elapsed}ms`);
                                updateResult('post', '<div style="color: #28a745; font-weight: bold;">âœ… æ‰“å­—æ•ˆæœæœ€ç»ˆç»“æœï¼š</div><div style="background: #f8fff9; padding: 10px; border-radius: 4px; margin-top: 8px;">' + accumulatedText + '</div>');
                                return;
                            }
                            
                            // ğŸ”¥ å…³é”®æ‹¼æ¥é€»è¾‘ - æ‰“å­—æ•ˆæœç›´æ¥æ‹¼æ¥
                            const oldText = accumulatedText;
                            accumulatedText += data; // æ‰“å­—æ•ˆæœç›´æ¥æ‹¼æ¥
                            
                            addDebug('post', `ğŸ”— æ•°æ®æ‹¼æ¥: "${oldText}" + "${data}"`);
                            
                            // å®æ—¶æ›´æ–°æ˜¾ç¤º
                            updateResult('post', '<div style="color: #495057; font-weight: bold;">ğŸ“ æ‰“å­—æ•ˆæœå®æ—¶å†…å®¹ï¼š</div><div style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin-top: 8px;">' + accumulatedText + '</div>');
                        }
                    }
                }
                
            } catch (error) {
                if (error.name === 'AbortError') {
                    addDebug('post', 'ğŸ›‘ æ‰“å­—æ•ˆæœè¯·æ±‚å·²è¢«å–æ¶ˆ');
                    updateStatus('post', 'error', 'æ‰‹åŠ¨åœæ­¢');
                } else {
                    updateStatus('post', 'error', 'è¯·æ±‚å¤±è´¥');
                    addDebug('post', 'âŒ POSTæ‰“å­—æ•ˆæœè¯·æ±‚å¤±è´¥: ' + error.message);
                    updateResult('post', '<div style="color: #dc3545; font-weight: bold;">âŒ æ‰“å­—æ•ˆæœè¯·æ±‚å¤±è´¥: ' + error.message + '</div>');
                }
            }
        }
        
        function stopPost() {
            if (postAbortController) {
                postAbortController.abort();
                updateStatus('post', 'error', 'æ‰‹åŠ¨åœæ­¢');
                addDebug('post', 'ğŸ›‘ æ‰‹åŠ¨å–æ¶ˆPOSTè¯·æ±‚');
                postAbortController = null;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            addDebug('get', 'ğŸ’¡ GETæ–¹å¼ï¼šé€šè¿‡URLå‚æ•°ä¼ é€’æ•°æ®ï¼Œé€‚åˆç®€å•åœºæ™¯ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰');
            addDebug('post', 'ğŸ’¡ POSTæ–¹å¼ï¼šé€šè¿‡è¯·æ±‚ä½“ä¼ é€’å¤æ‚æ•°æ®ï¼Œç°ä»£AIæœåŠ¡æ ‡å‡†ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰');
        };
    </script>
</body>
</html>